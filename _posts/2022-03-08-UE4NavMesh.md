---
title: UE4NavMesh
tags: NavMesh A*
categories: UE4
---

<!-- TOC -->

- [Recast基础(导航数据构建)](#recast基础导航数据构建)
    - [Recast](#recast)
- [Detour寻路](#detour寻路)
    - [A*算法得到Poly组成的路径](#a算法得到poly组成的路径)
- [UE寻路结构](#ue寻路结构)
- [tricks](#tricks)

<!-- /TOC -->

## Recast基础(导航数据构建)
所谓的导航数据准备就是对地形数据抽象和简化，生成人工智能理解的导航数据。
- 多边形裁剪是直接对地形的多边形网格数据进行裁剪及合并，从而生成导航网格。方法比较直观，但难度更高，目前havok引擎使用了此方法。
- 体素化是对地形多边形网格进行栅格化，然后用这些“格子”重新生成导航网格，方法更复杂，但难度更低，Recast使用了此方案，而UE4使用了Recast。

#### Recast
- 自动化，可以处理任意地形数据，输出导航网格
- 快速高效
- 能处理动态碰撞
- 开源，可根据自己游戏内容进行定制
- 自带可视化工具

Recast:将场景网格模型生成用于寻路的导航网格

Detour：利用导航网格进行寻路

Recast在运行时，首先会从关卡地形中构建一个体素模型，之后使用体素创建导航网格。

处理过程包括3步：创建体素模型，把模型分割成简单的区域，把这些区域再分割成简单多边形（凸的）

1. 通过把输入的三角形mesh进行光栅化，形成一个多层的高度场，就能得到体素模型。之后可以对体素模型做一些简单的过滤，去掉玩家不可达的位置
2. 体素模型描述的可行走区域被划分为重叠的2D区域，这些区域只有一个未重叠的等高线，这可以大大简化最后一步处理步骤
3. 首先沿着边界划这些区域并进行化简可以剥离出导航多边形。然后把这些导航多边形处理为凸多边形，凸多边形可以更好的用于寻路和对场景进行空间推理。

暂时与现工作无关聚焦Detour寻路过程

## Detour寻路
Detour可以对任何NavMesh数据进行寻路，只不过对Recast生成的支持性更好。
首先要清楚一点，我们已经将数据进行了抽象化，当我们寻路的结果也是一个抽象的数据，需要把他再转化成直接的坐标点路径，我们获得的是由NavMesh生成的多边形组成的路径，需要以此为转化。

#### A*算法得到Poly组成的路径

## UE寻路结构


## tricks
NavMesh有两种生成方式
Dynamic 跟NavigationInvoker关联 动态生成但是慢
Static 一旦生成好了,运行时就直接用,没有生成开销了

